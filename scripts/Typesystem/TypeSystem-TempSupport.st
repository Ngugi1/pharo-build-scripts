Object subclass: #SubtypeDefiner	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'TypeSystem-TempSupport'!"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!SubtypeDefiner class	instanceVariableNames: ''!!SubtypeDefiner class methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/16/2011 15:23'!initialize	"TypeConfiguration uniqueInstance bootstrap ifFalse: [^self]."	"Nominal and Nominal registration"	Type registerConsistentSubtypeRelationBetween: NominalType and: NominalType using:		 [:t1 : t2| 			|c1 c2| 			c1:= t1 classRef.			c2 := t2 classRef.			((t1 notNil) & (t2 notNil))				ifTrue: [(c1 == c2 or: [c1 inheritsFrom: c2])] 				ifFalse: [true] "reduce the numbers of error. We supose that there is a validation of types first"		].	Type registerSubtypeRelationBetween: NominalType and: NominalType using:		 [:t1 : t2| 			|c1 c2| 			c1:= t1 classRef.			c2 := t2 classRef.			((t1 notNil) & (t2 notNil))				ifTrue: [(c1 == c2 or: [c1 inheritsFrom: c2])] 				ifFalse: [true] "reduce the numbers of error. We supose that there is a validation of types first"		].	"Structural and Structural registration"	Type registerConsistentSubtypeRelationBetween: StructuralType and: StructuralType using:		 [:t1 : t2| 			t1 isConsistentStructuralSubtype: t2.		].	Type registerSubtypeRelationBetween: StructuralType and: StructuralType using:		 [:t1 : t2| 			t1 isStructuralSubtype: t2.		].	"Structural and Type registration"	Type registerConsistentSubtypeRelationBetween: StructuralType and: Type using:		 [:t1 : t2| 			t1 base isConsistentSubtypeOf: t2.		].	Type registerSubtypeRelationBetween: StructuralType and: Type using:		 [:t1 : t2| 			t1 base isSubtypeOf: t2.		].		"Type and Structural registration"	Type registerConsistentSubtypeRelationBetween: Type and: StructuralType using:		 [:t1 : t2| 			(StructuralType new base: t1) isConsistentSubtypeOf: t2.		].	Type registerSubtypeRelationBetween: Type and: StructuralType using:		 [:t1 : t2| 			(StructuralType new base: t1) isSubtypeOf: t2.		].		"Lambda and Lambda registration"	Type registerConsistentSubtypeRelationBetween: LambdaType and: LambdaType using:		 [:t1 : t2| 			t1 isLambdaConsistentSubtypeOf: t2.		].	Type registerSubtypeRelationBetween: LambdaType and: LambdaType using:		 [:t1 : t2| 			t1 isLambdaSubtypeOf: t2.		].	"Lambda and Nominal registration"	Type registerConsistentSubtypeRelationBetween: LambdaType and: NominalType using:		 [:t1 : t2| 			LambdaType lambdaNominalClass isConsistentSubtypeOf: t2.		].	Type registerSubtypeRelationBetween: LambdaType and: NominalType using:		 [:t1 : t2| 			LambdaType lambdaNominalClass isSubtypeOf: t2.		].		"Self and Self registration"	Type registerConsistentSubtypeRelationBetween: SelfType and: SelfType using:		 [:t1 : t2| 			t1 kind = t2 kind.		].	Type registerSubtypeRelationBetween: SelfType and: SelfType using:		 [:t1 : t2| 			t1 kind = t2 kind.		].	"Self and Nominal registration"	Type registerConsistentSubtypeRelationBetween: SelfType and: NominalType using:		 [:t1 : t2| 			t1 classRef asType isConsistentSubtypeOf: t2		].	Type registerSubtypeRelationBetween: SelfType and: NominalType using:		 [:t1 : t2| 			t1 classRef asType isSubtypeOf: t2		].	"Dyn registration"	Type registerConsistentSubtypeRelationBetween: Type and: DynType using:		 [:t1 : t2| 			true		].	Type registerConsistentSubtypeRelationBetween: DynType and: Type using:		 [:t1 : t2| 			true		].	Type registerSubtypeRelationBetween: DynType and: DynType using:		 [:t1 : t2| 			true		].! !PPBaseSmalltalkGrammar subclass: #PPTypeGrammar	instanceVariableNames: 'selfType dynType nominalClassType nominalType basicType methodSignatures unaryType selector parenType methodSignature nominalIdentifier type multipleKeywordToken lambdaType complexType lambdaSpecialToken'	classVariableNames: ''	poolDictionaries: ''	category: 'TypeSystem-TempSupport'!!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:19'!basicType	^ selfType / dynType / nominalClassType / nominalType! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:26'!complexType	^ basicType optional , ${ asParser smalltalkToken , methodSignatures , $} asParser smalltalkToken! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:26'!dynType	^ $? asParser smalltalkToken! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:35'!lambdaSpecialToken	^ (Unicode charFromUnicode: 8594) asParser! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:35'!lambdaType	^ unaryType star , ('->' asParser / lambdaSpecialToken) smalltalkToken , unaryType! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:27'!methodSignature	^ selector , parenType! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/16/2011 17:02'!methodSignatures	^ ((methodSignature , $. asParser smalltalkToken) star , methodSignature) ==> [:nodes| (nodes first collect: [:each|each first]) asOrderedCollection addLast: nodes second; yourself]! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:28'!multipleKeywordToken	^keywordToken plus ==> [:tokens| PPSpecialSmalltalkToken on: tokens "PPSmalltalkToken on: (token inject: '' into: [:res :each| res, each value trimBoth])"]! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/15/2011 19:04'!nominalClassType	^ (nominalIdentifier , 'class' asParser) smalltalkToken ! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:29'!nominalIdentifier	^ (#uppercase asParser , #word asParser star) smalltalkToken! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:29'!nominalType	^ nominalIdentifier! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:29'!parenType	^ $( asParser smalltalkToken , type , $) asParser smalltalkToken! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:30'!selector	^ multipleKeywordToken / unaryToken / binaryToken! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:30'!selfType	^ 'Self' asParser smalltalkToken, ('class' asParser / 'instance' asParser) smalltalkToken optional! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:30'!type	^ lambdaType / complexType / basicType! !!PPTypeGrammar methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 00:31'!unaryType	^ basicType / parenType! !PPTypeGrammar subclass: #PPTypeParser	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'TypeSystem-TempSupport'!!PPTypeParser methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/12/2011 12:24'!complexType	^ super complexType		==> [:nodes | StructuralType new base: (nodes first ifNil: [Object asType]);				 methods: nodes third]! !!PPTypeParser methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 11:47'!dynType	^ super dynType		==> [:nodes | DynType explicitInstance]! !!PPTypeParser methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 11:48'!lambdaType	^ super lambdaType		==> [:nodes | 			| ltype |			ltype := LambdaType new.			ltype params: nodes first.			ltype return: nodes last.]! !!PPTypeParser methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/12/2011 12:28'!methodSignature	^ super methodSignature		==> [:nodes | MethodSignature new selector: (nodes first) value asSymbol; signature: nodes last]! !!PPTypeParser methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 11:38'!nominalClassType	^ super nominalClassType		==> [:token | NominalType named: token value]! !!PPTypeParser methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 11:34'!nominalType	^ super nominalType		==> [:token | NominalType named: token value]! !!PPTypeParser methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/12/2011 12:28'!parenType	^super parenType ==>[:nodes| nodes second]! !!PPTypeParser methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/5/2011 11:40'!selfType	^ super selfType		==> [:token | SelfType new kind: (token second ifNil: [#normal] ifNotNil: [token second value asSymbol])]! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!PPTypeParser class	instanceVariableNames: ''!!PPTypeParser class methodsFor: 'as yet unclassified' stamp: 'EstebanAllende 12/16/2011 17:04'!initialize	TypeConfiguration uniqueInstance bootstrap ifFalse: [^self].	PPTypedSmalltalkGrammar typeGrammar: self new type.	PPTypedSmalltalkParser typeGrammar: self new type.	PPTypedSmalltalkParser typeParser: self new type.! !SubtypeDefiner initialize!PPTypeParser initialize!